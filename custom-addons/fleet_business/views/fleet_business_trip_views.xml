<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <record id="fleet_business_trip_view_tree" model="ir.ui.view">
      <field name="name">fleet.business.trip.tree</field>
      <field name="model">fleet.business.trip</field>
      <field name="arch" type="xml">
        <tree>
          <field name="name" string='Sequence ID'/>
          <field name="overseer_creator_id" />
          <field name="attending_employee_count"/>
          <field name="vehicle_id"/>
          <field name="driver_id"/>
          <field name="pick_time"/>
          <field name="pick_address_id"/>
          <field name="to_street"/>
          <field name="state" widget="badge"
            decoration-success="state == ['approved','returned']" 
            decoration-danger="state == ['not_approved','canceled','car_na','driver_na','car_driver_na']"
            decoration-info="state == ['ready','departing','returning']"
            decoration-warning="state == ['late','incident']"/>
        </tree>
      </field>
    </record>

    <record id="fleet_business_trip_view_form" model="ir.ui.view">
      <field name="name">fleet.business.trip.form</field>
      <field name="model">fleet.business.trip</field>
      <field name="arch" type="xml">
        <form duplicate="0">
          <header>
            <field name="company_id" invisible='1'/>
            <field name="active" invisible="1" />
            <field name="overseer_manager_logged" string='test logged manager' invisible="1"/>
            <field name="overseer_admin_logged" string='test logged admin' invisible="1"/>
            <field name="overseer_creator_logged" string='test logged creator' invisible="1"/>
            <field name="overseer_fleet_logged" string='test logged fleet' invisible="1"/>
            <field name="attendee_logged" string='test logged attendee' invisible="1"/>
            <field name="attendee_rated" string='test attendee rated' invisible="1"/>
            <!--? custom conditional css -->
            <field name="edit_hide_css_user"/>
            <!--! testing -->
            <!-- <field name="curr_deciding_overseer_id" string='name'/>
            <field name="curr_deciding_overseer_role" string='role'/> -->

            <!--! might want to create some logic to prevent constant re-approval -->
            
            <!-- <button name="action_request_reapproval" string="Test Request Re-approval" type="object" icon="fa-repeat" class="oe_highlight"/> -->
            <!--! <button name="action_send_email" string="Send Test Email" type="object" icon="fa-envelope"/>
            <button name="action_send_mass_email" string="Send Test Mass Email" type="object" icon="fa-envelope"/> -->
            <!--! <button name="action_update_state_returned" string="Test Confirm Trip Completed" type="object" icon="fa-car"
              attrs="{'invisible':['|', ('state', 'not in', ['departing','returning','late']),('overseer_admin_logged', '=', False)]}"/> -->
              
            <!--! <button name="action_update_state_departing" string="Test Trip Departing" type="object" icon="fa-car"/>
            <button name="action_update_state_returned" string="Test Confirm Trip Completed" type="object" icon="fa-car"/> -->
            
            <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive" string="Archive Trip" attrs="{
                'invisible': ['|',('overseer_creator_logged', '=', False), ('state', 'not in', ['draft','canceled'])], 
                'readonly':  ['|',('overseer_creator_logged', '=', False), ('state', 'not in', ['draft','canceled'])],
              }">
              <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
            </button>
            <button name="action_request_reapproval" string="Request Re-approval" type="object" icon="fa-repeat" class="oe_highlight" attrs="{
              'invisible': ['|','&amp;',('overseer_creator_logged', '=', False),('overseer_admin_logged', '=', False), ('state', '!=', 'canceled')],}"/>
            <button name="action_rate_driver" string="Rate Driver" type="object" icon="fa-star" class="oe_highlight" attrs="{
              'invisible': ['|','|',('attendee_logged', '=', False),('attendee_rated', '!=', False),('state', '!=', 'returned')],}"/>

            <!--? approval buttons -->
            <button name="action_approval_manager_approved" string="Manager Approve" type="object" class="oe_highlight"
              attrs="{'invisible':['|', ('approval_manager', '!=', 'deciding'),('overseer_manager_logged', '=', False)]}"/>
            <button name="action_approval_manager_denied" string="Manager Deny" type="object" 
              attrs="{'invisible':['|', ('approval_manager', '!=', 'deciding'),('overseer_manager_logged', '=', False)]}"/>

            <button name="action_approval_admin_approved" string="Admin Approve" type="object" class="oe_highlight"
              attrs="{'invisible':['|',('approval_admin', '!=', 'deciding'),('overseer_admin_logged', '=', False)]}"/>
            <button name="action_approval_admin_denied" string="Admin Deny" type="object" 
              attrs="{'invisible':['|',('approval_admin', '!=', 'deciding'),('overseer_admin_logged', '=', False)]}"/>

            <button name="action_approval_creator_approved" string="Creator Approve" type="object" class="oe_highlight"
              attrs="{'invisible':['|',('approval_creator', '!=', 'deciding'),('overseer_creator_logged', '=', False)]}"/>
            <button name="action_approval_creator_request_rework" string="Request Rework" type="object" 
              attrs="{'invisible':['|',('approval_creator', '!=', 'deciding'),('overseer_creator_logged', '=', False)]}"/>
            <button name="action_approval_creator_cancel" string="Creator Deny" type="object" 
              attrs="{'invisible':['|',('approval_creator', '!=', 'deciding'),('overseer_creator_logged', '=', False)]}"/>

            <button name="action_approval_fleet_approved" string="Fleet Approve" type="object" class="oe_highlight"
              attrs="{'invisible':['|',('approval_fleet', '!=', 'deciding'),('overseer_fleet_logged', '=', False)]}"/>
            <button name="action_approval_fleet_denied" string="Fleet Deny" type="object" 
              attrs="{'invisible':['|',('approval_fleet', '!=', 'deciding'),('overseer_fleet_logged', '=', False)]}"/>

            <field name="state" widget="statusbar" nolabel="1"
              statusbar_visible="draft,not_approved,approved,ready,departing,returning,late,returned,cancled,incident"/>
          </header>
          
          <sheet>
            <div class="oe_button_box" name="button_box">
              <!--? overseers -->
              <!--! add buttons to choose missing overseers -->
              <button name="action_view_overseer" context="{'view_overseer': 'manager','view_overseer_id': overseer_manager_id}"  type="object" class="oe_stat_button" icon="fa-id-card-o">
                <div class="o_field_widget o_stat_info">
                    <span class="o_stat_value">
                      <field name="overseer_manager_id" readonly="1" attrs="{'invisible': [('overseer_manager_id', '=', False)]}"/>
                      <strong attrs="{'invisible': [('overseer_manager_id', '!=', False)]}">Missing Manager</strong>
                    </span>
                    <span class="o_stat_text">Manager</span>
                </div>
              </button>
              <button name="action_view_overseer" context="{'view_overseer': 'admin','view_overseer_id': overseer_admin_id}" type="object" class="oe_stat_button" icon="fa-id-card-o">
                <div class="o_field_widget o_stat_info">
                    <span class="o_stat_value">
                      <field name="overseer_admin_id" readonly="1" attrs="{'invisible': [('overseer_admin_id', '=', False)]}"/>
                      <strong attrs="{'invisible': [('overseer_admin_id', '!=', False)]}">Missing Admin</strong>
                    </span>
                    <span class="o_stat_text">Administator</span>
                </div>
              </button>
              <button name="action_view_overseer" context="{'view_overseer': 'creator','view_overseer_id': overseer_creator_id}" type="object" class="oe_stat_button" icon="fa-id-card-o" attrs="{'invisible': [('overseer_creator_id', '=', False)]}">
                <div class="o_field_widget o_stat_info">
                    <span class="o_stat_value">
                      <field name="overseer_creator_id" readonly="1" attrs="{'invisible': [('overseer_creator_id', '=', False)]}"/>
                      <strong attrs="{'invisible': [('overseer_creator_id', '!=', False)]}">Missing Creator</strong>
                    </span>
                    <span class="o_stat_text">Trip Requester</span>
                </div>
              </button>
              <button name="action_view_overseer" context="{'view_overseer': 'fleet','view_overseer_id': overseer_fleet_id}" type="object" class="oe_stat_button" icon="fa-id-card-o" attrs="{'invisible': [('overseer_fleet_id', '=', False)]}">
                <div class="o_field_widget o_stat_info">
                    <span class="o_stat_value">
                      <field name="overseer_fleet_id" readonly="1" attrs="{'invisible': [('overseer_fleet_id', '=', False)]}"/>
                      <strong attrs="{'invisible': [('overseer_fleet_id', '!=', False)]}">Missing fleet</strong>
                    </span>
                    <span class="o_stat_text">Fleet Captain</span>
                </div>
              </button>
              
              <button name="action_view_attendees" type="object" class="oe_stat_button" icon="fa-history">
                <field name="attending_employee_count" string="Attendees" widget="statinfo"/>
              </button>
              <button class="oe_stat_button" icon="fa-list">
                <field name="journal_line_count" string="Journals" widget="statinfo"/>
              </button>
            </div>

            <!--? approval alerts -->
            <span attrs="{'invisible':['|', ('approval_manager', '=', False), ('overseer_manager_logged', '=', False),]}">
              <div class="alert alert-warning text-center o_form_header" role="alert" attrs="{'invisible':[('approval_manager', '!=', 'deciding')]}">
                <div>
                  <strong>You, the manager Need to decide the approval of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-success text-center o_form_header" role="alert" attrs="{'invisible':[('approval_manager', '!=', 'approved')]}">
                <div>
                  <strong>You, the manager have approve of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-danger text-center o_form_header" role="alert" attrs="{'invisible':[('approval_manager', '!=', 'denied')]}">
                <div>
                  <strong>You, the manager have deny this business trip</strong>
                </div>
              </div>
            </span>

            <span attrs="{'invisible':['|', ('approval_admin', '=', False), ('overseer_admin_logged', '=', False),]}">
              <div class="alert alert-warning text-center o_form_header" role="alert" attrs="{'invisible':[('approval_admin', '!=', 'deciding')]}">
                <div>
                  <strong>You, the Admin Need to decide the approval of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-success text-center o_form_header" role="alert" attrs="{'invisible':[('approval_admin', '!=', 'approved')]}">
                <div>
                  <strong>You, the Admin have approve of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-danger text-center o_form_header" role="alert" attrs="{'invisible':[('approval_admin', '!=', 'denied')]}">
                <div>
                  <strong>You, the Admin have deny this business trip</strong>
                </div>
              </div>
            </span>

            <span attrs="{'invisible':['|', ('approval_creator', '=', False), ('overseer_creator_logged', '=', False),]}">
              <div class="alert alert-warning text-center o_form_header" role="alert" attrs="{'invisible':[('approval_creator', '!=', 'deciding')]}">
                <div>
                  <strong>You, the Creator Need to decide the approval of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-success text-center o_form_header" role="alert" attrs="{'invisible':[('approval_creator', '!=', 'approved')]}">
                <div>
                  <strong>You, the Creator have approve of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-danger text-center o_form_header" role="alert" attrs="{'invisible':[('approval_creator', '!=', 'denied')]}">
                <div>
                  <strong>You, the Creator have deny this business trip</strong>
                </div>
              </div>
            </span>

            <span attrs="{'invisible':['|', ('approval_fleet', '=', False), ('overseer_fleet_logged', '=', False),]}">
              <div class="alert alert-warning text-center o_form_header" role="alert" attrs="{'invisible':[('approval_fleet', '!=', 'deciding')]}">
                <div>
                  <strong>You, the Fleet Captain Need to decide the approval of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-success text-center o_form_header" role="alert" attrs="{'invisible':[('approval_fleet', '!=', 'approved')]}">
                <div>
                  <strong>You, the Fleet Captain have approve of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-danger text-center o_form_header" role="alert" attrs="{'invisible':[('approval_fleet', '!=', 'denied')]}">
                <div>
                  <strong>You, the Fleet Captain have deny this business trip</strong>
                </div>
              </div>
            </span>
            
            <div class="oe_title">
              <h1>
                  <field name="name"/>
              </h1>
              <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}" placeholder="Tags"/>
            </div>

            <group>
              <group string="Vehicle">
                <field name="vehicle_id"/>
                <field name="seats" />
              </group>
              <group string="Driver">
                <field name="driver_id" attrs="{'invisible':[('self_driving_employee_id', '!=', False)]}"/>
                <field name="self_driving_employee_id" attrs="{'invisible':[('driver_id', '!=', False)]}"/>
              </group>
            </group>
            <group string='All Attending Employees'>
              <field name="attending_employee_ids" widget="many2many_tags" options="{'no_create_edit': True}" nolabel='1'/>
            </group>
            <group>
              <group string='Time'>
                <field name='pick_time' />
                <field name='return_time' />
                <field name="due_for_approval_time" />
              </group>
              <group string='Estamated Time'>
                <field name='arrive_time' />
                <field name='back_time' />
              </group>
              <group string='Go To Location'>
                <field name='to_street' />
                <field name='to_street2' />
                <field name='to_zip' />
                <field name='to_city' />
                <field name='to_state_id'/>
                <field name='to_country_id'/>
              </group>
              <group string='Pick up Location'>
                <field name="pick_address_id" context="{'show_address': 1}"
                  options='{"always_reload": True, "highlight_first_line": True}'/>
              </group>
            </group>

            <notebook>
              <page string="Intentions">
                <group>
                  <field name="intent" />
                  <field name="note" />
                </group>
              </page>

              <page string="Overseers">
                <group>
                  <group string="Creator">
                    <field name="overseer_creator_id"/>
                    <field name="overseer_creator_work_phone" />
                    <field name="overseer_creator_email" />
                    <field name="approval_creator" />
                  </group>
                  <group string="Manager">
                    <field name="overseer_manager_id" />
                    <field name="overseer_manager_work_phone" />
                    <field name="overseer_manager_email" />
                    <field name="approval_manager" />
                  </group>
                  <group string="Administrator">
                    <field name="overseer_admin_id" attrs="{'readonly':[('approval_manager', '!=', 'approved')]}"/>
                    <field name="overseer_admin_work_phone" />
                    <field name="overseer_admin_email" />
                    <field name="approval_admin" />
                  </group>
                  <group string="Fleet Captain">
                    <field name="overseer_fleet_id" />
                    <field name="overseer_fleet_work_phone" />
                    <field name="overseer_fleet_email" />
                    <field name="approval_fleet" />
                  </group>
                </group>
              </page>

              <page string="Vehicle">
                <group>
                  <field name="model_id" class="oe_inline" placeholder="e.g. PAE 326"/>
                  <field name="license_plate" class="oe_inline" placeholder="e.g. PAE 326"/>
                </group>
              </page>

              <!--! set groups admin only -->
              <page string="Journal">
                <field name="journal_line_ids">
                  <tree editable="bottom">
                    <field name="type" />
                    <field name="note" />
                    <field name="create_date" string="Updated on"/>
                  </tree>
                  <form>
                    <group>
                      <field name="type" />
                      <field name="note" />
                      <field name="create_date" string="Updated on"/>
                    </group>
                  </form>
                </field>
              </page>
            </notebook>
          </sheet>

          <div class="oe_chatter">
            <field name="message_follower_ids" groups="fleet.fleet_group_user"/>
            <field name="message_ids"/>
          </div>
        </form>
      </field>
    </record>

    <!--? view permissions for fleet_group_manager -->
    <record id="fleet_business_trip_view_form_manager_permissions_inherit_fleet_business" model="ir.ui.view">
      <field name="name">fleet.business.trip.form.manager.permissions</field>
      <field name="model">fleet.business.trip</field>
      <field name="inherit_id" ref="fleet_business_trip_view_form"/>
      <field name="groups_id" eval="[(6, 0, [ref('fleet.fleet_group_manager') ])]" />
      <field name="priority">10</field>
      <field name="arch" type="xml">
        <xpath expr="//form" position="attributes">
          <attribute name="duplicate">1</attribute>
        </xpath>
      </field>
    </record>

  </data>

</odoo>
