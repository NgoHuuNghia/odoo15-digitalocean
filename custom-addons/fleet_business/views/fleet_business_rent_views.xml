<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <record id="fleet_business_rent_view_tree" model="ir.ui.view">
      <field name="name">fleet.business.rent.tree</field>
      <field name="model">fleet.business.rent</field>
      <field name="arch" type="xml">
        <tree default_order='due_for_approval_time asc'>
          <field name="name" string='Sequence ID'/>
          <field name="create_uid" string='creator' widget="many2one_avatar_user"/>
          <field name="type_of_transportation"/>
          <field name="attending_employee_count"/>
          <field name="due_for_approval_time" optional="show"/>
          <field name="pick_time"/>
          <field name="return_time" optional="hide"/>
          <field name="pick_address_id"/>
          <field name="to_street"/>
          <field name="state" widget="badge" optional="show"
            decoration-success="state in ['approved','returned']" 
            decoration-danger="state in ['not_approved','canceled','car_na','driver_na','car_driver_na']"
            decoration-info="state in ['ready','departing','returning']"
            decoration-warning="state in ['late','incident']"/>
        </tree>
      </field>
    </record>

    <record id="fleet_business_rent_view_search" model="ir.ui.view">
      <field name="name">fleet.business.rent.search</field>
      <field name="model">fleet.business.rent</field>
      <!--* and this where we write our search (arch is mandatory) -->
      <field name="arch" type="xml">
        <search>

          <field name="name" string="Trip Sequence"/>
          <field name="overseer_manager_id" string="Manager Overseer"/>
          <field name="overseer_admin_id" string="Administrator Overseer"/>
          <field name="overseer_creator_id" string="Creator"/>
          <field name="attending_employee_ids" string="Attendee"/>

          <filter name="filter_overseer_manager_id" string="Managing" domain="[('overseer_manager_id.user_id', '=', uid)]" />
          <filter name="filter_overseer_admin_id" string="Admining" domain="[('overseer_admin_id.user_id', '=', uid)]" />
          <filter name="filter_overseer_creator_id" string="Created" domain="[('overseer_creator_id.user_id', '=', uid)]" />
          <filter name="filter_attending_employee_ids" string="Attending" domain="[('attending_employee_ids.user_id','in',[uid])]" />
          <separator />
          <!--! these datetime filters might need rework -->
          <filter name="filter_due_for_approval_time" string="Due Time" domain="[
            ('due_for_approval_time', '&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))
          ]"/>
          <filter name="filter_pick_time" string="Pick Time" domain="[
            ('pick_time', '&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))
          ]"/>
          <filter name="filter_return_time" string="Return Time" domain="[
            ('return_time', '&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))
          ]"/>
          <separator />
          <filter name="filter_archive" string="Archived" domain="[('active', '=', False)]" />

          <group expand="0" string="Group By">
            <filter string="Transportation Type" name="group_by_type_of_transportation" context="{'group_by':'type_of_transportation'}"/>
            <filter string="State" name="group_by_state" context="{'group_by':'state'}"/>
            <filter string="Creator" name="group_by_creator" context="{'group_by':'overseer_creator_id'}"/>
            <filter string="Manager" name="group_by_manager" context="{'group_by':'overseer_manager_id'}"/>
            <filter string="Administrator" name="group_by_admin" context="{'group_by':'overseer_admin_id'}"/>
            <filter string="Pick Up" name="group_by_pick_address" context="{'group_by':'pick_address_id'}"/>
            <filter string="Starting Station" name="group_by_pick_station_address" context="{'group_by':'pick_station_address_id'}"/>
          </group>

          <searchpanel>
            <field name="state" string="State" icon="fa-question" select="multi" enable_counters="1"/>
            <field name="type_of_transportation" string="Transportation Type" icon="fa-car" select="multi" enable_counters="1"/>
          </searchpanel>

        </search>
      </field>
    </record>

    <record id="fleet_business_rent_view_form" model="ir.ui.view">
      <field name="name">fleet.business.rent.form</field>
      <field name="model">fleet.business.rent</field>
      <field name="arch" type="xml">
        <form duplicate="0">
          <header>
            <field name="company_id" invisible='1'/>
            <field name="active" invisible="1" />
            <field name="overseer_manager_logged" invisible="1"/>
            <field name="overseer_admin_logged" invisible="1"/>
            <field name="overseer_creator_logged" invisible="1"/>
            <field name="admin_manager_logged" invisible="1"/>
            <field name="going_ticket_count" invisible="1"/>
            <field name="returning_ticket_count" invisible="1"/>
            <field name="two_way_ticket_count" invisible="1"/>
            <!--? custom conditional css -->
            <field name="edit_hide_css_user"/>
            <!--! testing -->
            <!-- <field name="curr_deciding_overseer_id" string='name'/>
            <field name="curr_deciding_overseer_role" string='role'/> -->

            <!--! might want to create some logic to prevent constant re-approval -->
            
            <!-- <button name="action_request_reapproval" string="Test Request Re-approval" type="object" icon="fa-repeat" class="oe_highlight"/> -->
            <!--! <button name="action_send_email" string="Send Test Email" type="object" icon="fa-envelope"/>
            <button name="action_send_mass_email" string="Send Test Mass Email" type="object" icon="fa-envelope"/> -->
            <!-- <button name="action_update_state_returned" string="Test Confirm Trip Completed" type="object" icon="fa-car"
              attrs="{'invisible':['|', ('state', 'not in', ['departing','returning','late']),('overseer_admin_logged', '=', False)]}"/> -->
            <button name="action_update_state_returned" string="Test Confirm Trip Completed" type="object" icon="fa-car"/>

            <!-- <button name="action_update_state_ready" string="Test Trip Ready" type="object" icon="fa-car"/>
            <button name="action_update_state_departing" string="Test Trip Departing" type="object" icon="fa-car"/>
            <button name="action_update_state_returning" string="Test Confirm Trip returning" type="object" icon="fa-car"/>
            <button name="action_update_state_late" string="Test Confirm Trip late" type="object" icon="fa-car"/> -->
            <!-- <button name="action_update_and_mail_ready" string="Test Confirm Trip Ready" type="object" icon="fa-star"/>
            <button name="action_update_and_mail_departing" string="Test Confirm Trip departing" type="object" icon="fa-star"/>
            <button name="action_update_and_mail_late" string="Test Confirm Trip late" type="object" icon="fa-star"/>
            
            <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive" string="Archive Trip" attrs="{
                'invisible': ['|',('overseer_creator_logged', '=', False), ('state', 'not in', ['draft','canceled'])], 
                'readonly':  ['|',('overseer_creator_logged', '=', False), ('state', 'not in', ['draft','canceled'])],
              }">
              <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
            </button> -->
            <button name="action_request_reapproval" string="Request Re-approval" type="object" icon="fa-repeat" class="oe_highlight" attrs="{
              'invisible': ['|','&amp;',('overseer_creator_logged', '=', False),('overseer_admin_logged', '=', False), ('state', 'not in', ['not_approved','canceled'])],}"/>
            <button name="action_prepare_going_and_returning_ticket_template" string="Create 2 Ticket Template" type="object" icon="fa-plus" class="oe_highlight" attrs="{
              'invisible': ['|','|','|',('overseer_admin_logged', '=', False),('going_ticket_count', '!=', 0),('returning_ticket_count', '!=', 0),('two_way_ticket_count', '!=', 0)]}"/>
            <button name="action_prepare_two_way_ticket_template" string="Create 1 Two Way Ticket Template" type="object" icon="fa-plus" class="oe_highlight" attrs="{
              'invisible': ['|','|','|',('overseer_admin_logged', '=', False),('going_ticket_count', '!=', 0),('returning_ticket_count', '!=', 0),('two_way_ticket_count', '!=', 0)]}"/>
            <button name="action_prepare_going_and_returning_ticket_template" string="Replace With 2 Ticket Template" type="object" icon="fa-minus" class="oe_highlight" attrs="{
              'invisible': ['|','|','|','|',('overseer_admin_logged', '=', False),('approval_admin', '!=', 'deciding'),('going_ticket_count', '!=', 0),('returning_ticket_count', '!=', 0),('two_way_ticket_count', '=', 0)]}"/>
            <button name="action_prepare_two_way_ticket_template" string="Replace with 1 Two Way Ticket Template" type="object" icon="fa-minus" class="oe_highlight" attrs="{
              'invisible': ['|','|','|','|',('overseer_admin_logged', '=', False),('approval_admin', '!=', 'deciding'),('going_ticket_count', '=', 0),('returning_ticket_count', '=', 0),('two_way_ticket_count', '!=', 0)]}"/>

            <!--? approval buttons -->
            <button name="action_approval_manager_approved" string="Manager Approve" type="object" class="oe_highlight"
              attrs="{'invisible':['|', ('approval_manager', '!=', 'deciding'),('overseer_manager_logged', '=', False)]}"/>
            <button name="action_approval_manager_denied" string="Manager Deny" type="object" 
              attrs="{'invisible':['|', ('approval_manager', '!=', 'deciding'),('overseer_manager_logged', '=', False)]}"/>

            <button name="action_approval_admin_approved" string="Admin Approve" type="object" class="oe_highlight"
              attrs="{'invisible':['|','|',('approval_admin', '!=', 'deciding'),('overseer_admin_logged', '=', False),'&amp;','|',
              ('going_ticket_count', '=', 0),('returning_ticket_count', '=', 0),('two_way_ticket_count', '=', 0)]}"/>
            <button name="action_approval_admin_denied" string="Admin Deny" type="object" 
              attrs="{'invisible':['|',('approval_admin', '!=', 'deciding'),('overseer_admin_logged', '=', False)]}"/>

            <button name="action_approval_creator_approved" string="Creator Approve" type="object" class="oe_highlight"
              attrs="{'invisible':['|',('approval_creator', '!=', 'deciding'),('overseer_creator_logged', '=', False)]}"/>
            <!--! <button name="action_approval_creator_request_rework" string="Request Rework" type="object" 
              attrs="{'invisible':['|',('approval_creator', '!=', 'deciding'),('overseer_creator_logged', '=', False)]}"/> -->
            <button name="action_approval_creator_cancel" string="Creator Deny" type="object" 
              attrs="{'invisible':['|',('approval_creator', '!=', 'deciding'),('overseer_creator_logged', '=', False)]}"/>

            <field name="state" widget="statusbar" nolabel="1"
              statusbar_visible="draft,not_approved,approved,ready,departing,returning,late,returned,cancled,incident"/>
          </header>
          
          <sheet>
            <div class="oe_button_box" name="button_box">
              <!--? overseers -->
              <!--! add buttons to choose missing overseers -->
              <button name="action_view_overseer" context="{'view_overseer': 'manager','view_overseer_id': overseer_manager_id}"  type="object" class="oe_stat_button" icon="fa-id-card-o">
                <div class="o_field_widget o_stat_info">
                    <span class="o_stat_value">
                      <field name="overseer_manager_id" readonly="1" attrs="{'invisible': [('overseer_manager_id', '=', False)]}"/>
                      <strong attrs="{'invisible': [('overseer_manager_id', '!=', False)]}">Missing Manager</strong>
                    </span>
                    <span class="o_stat_text">Manager</span>
                </div>
              </button>
              <button name="action_view_overseer" context="{'view_overseer': 'admin','view_overseer_id': overseer_admin_id}" type="object" class="oe_stat_button" icon="fa-id-card-o">
                <div class="o_field_widget o_stat_info">
                    <span class="o_stat_value">
                      <field name="overseer_admin_id" readonly="1" attrs="{'invisible': [('overseer_admin_id', '=', False)]}"/>
                      <strong attrs="{'invisible': [('overseer_admin_id', '!=', False)]}">Missing Admin</strong>
                    </span>
                    <span class="o_stat_text">Administator</span>
                </div>
              </button>
              <button name="action_view_overseer" context="{'view_overseer': 'creator','view_overseer_id': overseer_creator_id}" type="object" class="oe_stat_button" icon="fa-id-card-o" attrs="{'invisible': [('overseer_creator_id', '=', False)]}">
                <div class="o_field_widget o_stat_info">
                    <span class="o_stat_value">
                      <field name="overseer_creator_id" readonly="1" attrs="{'invisible': [('overseer_creator_id', '=', False)]}"/>
                      <strong attrs="{'invisible': [('overseer_creator_id', '!=', False)]}">Missing Creator</strong>
                    </span>
                    <span class="o_stat_text">Trip Requester</span>
                </div>
              </button>
              
              <button name="action_view_attendees" type="object" class="oe_stat_button" icon="fa-history">
                <field name="attending_employee_count" string="Attendees" widget="statinfo"/>
              </button>
              <button name="action_view_journals" type="object" class="oe_stat_button" icon="fa-list" groups="fleet.fleet_group_manager">
                <field name="journal_line_count" string="Journals" widget="statinfo"/>
              </button>
            </div>

            <!--? approval alerts -->
            <span attrs="{'invisible':['|', ('approval_manager', '=', False), ('overseer_manager_logged', '=', False),]}">
              <div class="alert alert-warning text-center o_form_header" role="alert" attrs="{'invisible':[('approval_manager', '!=', 'deciding')]}">
                <div>
                  <strong>You, the manager Need to decide the approval of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-success text-center o_form_header" role="alert" attrs="{'invisible':[('approval_manager', '!=', 'approved')]}">
                <div>
                  <strong>You, the manager have approve of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-danger text-center o_form_header" role="alert" attrs="{'invisible':[('approval_manager', '!=', 'denied')]}">
                <div>
                  <strong>You, the manager have deny this business trip</strong>
                </div>
              </div>
            </span>

            <span attrs="{'invisible':['|', ('approval_admin', '=', False), ('overseer_admin_logged', '=', False),]}">
              <div class="alert alert-warning text-center o_form_header" role="alert" attrs="{'invisible':[('approval_admin', '!=', 'deciding')]}">
                <div>
                  <strong>You, the Admin Need to decide the approval of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-success text-center o_form_header" role="alert" attrs="{'invisible':[('approval_admin', '!=', 'approved')]}">
                <div>
                  <strong>You, the Admin have approve of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-danger text-center o_form_header" role="alert" attrs="{'invisible':[('approval_admin', '!=', 'denied')]}">
                <div>
                  <strong>You, the Admin have deny this business trip</strong>
                </div>
              </div>
            </span>

            <span attrs="{'invisible':['|', ('approval_creator', '=', False), ('overseer_creator_logged', '=', False),]}">
              <div class="alert alert-warning text-center o_form_header" role="alert" attrs="{'invisible':[('approval_creator', '!=', 'deciding')]}">
                <div>
                  <strong>You, the Creator Need to decide the approval of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-success text-center o_form_header" role="alert" attrs="{'invisible':[('approval_creator', '!=', 'approved')]}">
                <div>
                  <strong>You, the Creator have approve of this business trip</strong>
                </div>
              </div>
              <div class="alert alert-danger text-center o_form_header" role="alert" attrs="{'invisible':[('approval_creator', '!=', 'denied')]}">
                <div>
                  <strong>You, the Creator have deny this business trip</strong>
                </div>
              </div>
            </span>

            <span attrs="{'invisible':['|','|',('overseer_admin_id', '!=', False),('admin_manager_logged', '=', False),('approval_manager', '!=', 'approved')]}">
              <div class="alert alert-warning text-center o_form_header" role="alert">
                <div>
                  <strong>You, the Administrator Manager Need to assign an administrator for this business trip</strong>
                </div>
              </div>
            </span>

            <div class="oe_title">
              <h1>
                  <field name="name"/>
              </h1>
              <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}" placeholder="Tags"/>
              <group>
                <label for='type_of_transportation' string='Transportation'/>
                <h2>
                  <field name="type_of_transportation" widget="radio"/>
                </h2>
              </group>
            </div>

            <group string='All Attending Employees'>
              <field name="attending_employee_ids" widget="many2many_tags" options="{'no_create_edit': True}" nolabel='1'/>
            </group>
            <group>
              <group string='Time'>
                <field name='pick_time' />
                <field name='return_time' />
                <field name="due_for_approval_time" />
              </group>
              <group string='Estamated Time'>
                <field name='arrive_time' />
                <field name='back_time' />
              </group>
            </group>
            <group>
              <group string='Starting Address'>
                <field name="pick_address_id" context="{'show_address': 1}"
                  options='{"always_reload": True, "highlight_first_line": True}'/>
              </group>
              <group string='Pick up Station Address'>
                <field name="pick_station_address_id" context="{'show_address': 1}"
                  options='{"always_reload": True, "highlight_first_line": True}'
                  attrs="{'readonly':[('overseer_admin_logged', '=', False)]}"/>
              </group>
              <group string='Destination Address'>
                <field name='to_street' string='Street'/>
                <field name='to_street2' string='Street2'/>
                <field name='to_zip' string="Country's Zip"/>
                <field name='to_city' string='City'/>
                <field name='to_state_id' string='State/Province'/>
                <field name='to_country_id' string='Country'/>
              </group>
              <group string='Drop Off Station Address' >
                <field name='drop_off_station_street' string='Street' attrs="{'readonly':[('overseer_admin_logged', '=', False)]}"/>
                <field name='drop_off_station_street2' string='Street2' attrs="{'readonly':[('overseer_admin_logged', '=', False)]}"/>
                <field name='drop_off_station_zip' string="Country's Zip" attrs="{'readonly':[('overseer_admin_logged', '=', False)]}"/>
                <field name='drop_off_station_city' string='City' attrs="{'readonly':[('overseer_admin_logged', '=', False)]}"/>
                <field name='drop_off_station_state_id' string='State/Province' attrs="{'readonly':[('overseer_admin_logged', '=', False)]}"/>
                <field name='drop_off_station_country_id' string='Country' attrs="{'readonly':[('overseer_admin_logged', '=', False)]}"/>
              </group>
            </group>

            <notebook>
              <page string="Intentions">
                <group>
                  <field name="intent" />
                  <field name="note" />
                </group>
              </page>

              <page string="Going Tickets" attrs="{'invisible':[('going_ticket_count','=',0)]}">
                <field name="going_ticket_ids" options="{'create': False, 'delete': False}">
                  <tree editable="bottom">
                    <field name="name" string="Going Ticket's Serial"/>
                    <field name="attendee_id" />
                    <field name="ready" />
                    <field name="write_date" string="Updated on"/>
                  </tree>
                  <form>
                    <group>
                      <field name="name" />
                      <field name="attendee_id" />
                      <field name="ready" />
                      <field name="write_date" string="Updated on"/>
                    </group>
                  </form>
                </field>
              </page>
              <page string="Returning Tickets" attrs="{'invisible':[('returning_ticket_count','=',0)]}">
                <field name="returning_ticket_ids" options="{'create': False, 'delete': False}">
                  <tree editable="bottom">
                    <field name="name" string="Returning Ticket's Serial"/>
                    <field name="attendee_id" />
                    <field name="ready" />
                    <field name="write_date" string="Updated on"/>
                  </tree>
                  <form>
                    <group>
                      <field name="name" />
                      <field name="attendee_id" />
                      <field name="ready" />
                      <field name="write_date" string="Updated on"/>
                    </group>
                  </form>
                </field>
              </page>
              <page string="Two Way Tickets" attrs="{'invisible':[('two_way_ticket_count','=',0)]}">
                <field name="two_way_ticket_ids" options="{'create': False, 'delete': False}">
                  <tree editable="bottom">
                    <field name="name" string="Two Way Ticket's Serial"/>
                    <field name="attendee_id" />
                    <field name="ready" />
                    <field name="write_date" string="Updated on"/>
                  </tree>
                  <form>
                    <group>
                      <field name="name" />
                      <field name="attendee_id" />
                      <field name="ready" />
                      <field name="write_date" string="Updated on"/>
                    </group>
                  </form>
                </field>
              </page>
              <!--! Also create a two way ticket -->

              <page string="Overseers">
                <group>
                  <group string="Creator">
                    <field name="overseer_creator_id"/>
                    <field name="overseer_creator_work_phone" />
                    <field name="overseer_creator_email" />
                    <field name="approval_creator" />
                  </group>
                  <group string="Manager">
                    <field name="overseer_manager_id" />
                    <field name="overseer_manager_work_phone" />
                    <field name="overseer_manager_email" />
                    <field name="approval_manager" />
                  </group>
                  <group string="Administrator">
                    <field name="overseer_admin_id" attrs="{'readonly':[('approval_manager', '!=', 'approved')]}"/>
                    <field name="overseer_admin_work_phone" />
                    <field name="overseer_admin_email" />
                    <field name="approval_admin" />
                  </group>
                </group>
              </page>

              <!--! set groups admin only -->
              <page string="Journal" groups='fleet.fleet_group_manager'>
                <field name="journal_line_ids" attrs="{'readonly':[('overseer_admin_logged', '=', False)]}">
                  <tree editable="bottom">
                    <field name="type" />
                    <field name="note" />
                    <field name="create_date" string="Updated on"/>
                  </tree>
                  <form>
                    <group>
                      <field name="type" />
                      <field name="note" />
                      <field name="create_date" string="Updated on"/>
                    </group>
                  </form>
                </field>
              </page>
            </notebook>
          </sheet>

          <div class="oe_chatter">
            <field name="message_follower_ids" groups="fleet.fleet_group_user"/>
            <field name="message_ids"/>
          </div>
        </form>
      </field>
    </record>

    <!--? view permissions for fleet_group_manager -->
    <record id="fleet_business_rent_view_form_manager_permissions_inherit_fleet_business" model="ir.ui.view">
      <field name="name">fleet.business.rent.form.manager.permissions</field>
      <field name="model">fleet.business.rent</field>
      <field name="inherit_id" ref="fleet_business_rent_view_form"/>
      <field name="groups_id" eval="[(6, 0, [ref('fleet.fleet_group_manager') ])]" />
      <field name="priority">10</field>
      <field name="arch" type="xml">
        <xpath expr="//form" position="attributes">
          <attribute name="duplicate">1</attribute>
        </xpath>
      </field>
    </record>

  </data>

</odoo>
